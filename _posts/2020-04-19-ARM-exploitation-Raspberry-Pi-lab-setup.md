---
layout: single
title: "ARM Exploitation with Raspberry Pi: Lab Setup"
excerpt:  "Setting up your lab for ARM exploitation with Raspberry Pi requires a few steps to ensure that everything runs smoothly. In this blog post, I will provide a detailed guide on how to install Raspbian, disable security features, install the `gef` extension for `gdb`, and create a script for generating shellcode. These steps are crucial to enable you to start learning and practicing ARM exploitation with Raspberry Pi without any hassle."
seo_title:  "ARM Exploitation with Raspberry Pi: Setting Up Your Lab"
seo_description:  "In this blog post, I will guide you on how to set up your Raspberry Pi for ARM exploitation. This includes installing Raspbian, disabling security features, installing the `gef` extension for `gdb`, and creating a script for generating shellcode. With these steps, you can begin learning and practicing ARM exploitation with ease."
header:
  image: "https://live.staticflickr.com/65535/49800373047_f6a87384f1_h.jpg"
  teaser: "https://live.staticflickr.com/65535/49800373047_f6a87384f1_h.jpg"
categories:
  - Security
tags:
  - Exploitation
  - Tutorial
  - ARM
  - Buffer Overflow
  - Shellcode
toc: true
toc_label: "Table of Contents"
toc_icon: "heart"
---


In this post we will set up a lab for ARM exploitation using `Raspberry Pi Model 3 B+`.  

First, Install `Raspbian OS` in a Raspberry Pi by following the instructions put in the following post. It should take only a few minutes.

[Install Raspbian Os Raspberry Pi Without Monitor and Keyboard](https://shantoroy.com/raspberry%20pi/install-raspbian-os-raspberry-pi-without-monitor-keyboard/)

## Device Information
It is recommended to use `Raspbian GNU/Linux 10 (buster)` instead of the previous versions as the debugger (`gdb`) has some issues especially in `Raspbian GNU/Linux 9 (stretch)`.
The details of the device is as follows:
```bash
pi@raspberry:~$ hostnamectl 
   Static hostname: raspberrypi
         Icon name: computer
        Machine ID: 569839e402644ca38bef0b40a7832c8e
           Boot ID: fd208f512fd7418b9523bfde282383ca
  Operating System: Raspbian GNU/Linux 10 (buster)
            Kernel: Linux 4.19.66-v7+
      Architecture: arm
```

## Disable Security Features
Now, to exploit basic vulnerabilities, first we will disable some security features of the `kernel` and the `compiler`. 

### Disable Kernel Security
Here we disable the `Address Space Layout Randomization (**ASLR**)`. It randomizes the base address of an executable. We will first discuss on different attacks by disabling ASLR. Later we will discuss how to bypass ASLR.

Now, to disable `ASLR`, we create a configuration file in `/etc/sysctl.d/` directory and set the value `0` for randomization attribute.
```bash
pi@raspberry:~$ cd /etc/sysctl.d/
pi@raspberry:~$ sudo nano 1-aslr.conf
    kernel.randomize_va_space = 0
pi@raspberry:~$ reboot
```

After rebooting check the value as follows:
```bash
pi@raspberry:~$ sysctl kernel.randomize_va_space
    kernel.randomize_va_space = 0
```

### Disable Compiler Security Features
We need to disable the `stack protection` and enable execution within the stack to perform basic exploitation. So, we need to compile the vulnerable programs as follows:
```bash
pi@raspberry:~$ gcc -fno-stack-protector -z execstack overflow.c -o overflow
```

## Install `gef` extension for `gdb`
We will use **`gdb`** for debugging the vulnerable programs. To enhance some feature (e.g., checking value in Registers), `gdb` requires an extension named **`gef`**. Install `gef` using the following command:
```bash
pi@raspberry:~$ curl -s -L https://github.com/hugsy/gef/raw/master/scripts/gef.sh | sh
```

## Shellcode Generator
To generate shellcode from binary files, we use the following script named `hexstring.sh`.
```bash
#!/bin/bash
if [ $# -eq 0 ]
  then
    echo "Enter Name of your executable"
    echo "Format: hexstring.sh <binary>"
fi
if [ $# -eq 1 ]
  then
	objcopy -O binary $1 tmp.bin
	hexdump -v -e '"\\""x" 1/1 "%02x" ""' tmp.bin
fi
rm -fr tmp.bin
echo ""
```

We can also use the following python script from [Azeria-labs](https://azeria-labs.com/writing-arm-shellcode/).
```python
#!/usr/bin/env python
import sys
binary = open(sys.argv[1],'rb')
for byte in binary.read():
 sys.stdout.write("\\x"+byte.encode("hex"))
print ""
```

For example, `testf` is a binary file and the shellcode can be generated using the script as follows:
```bash
pi@raspberrypi:~$ ./hexstring.sh testf
\x0c\xb0\x8d\xe2\x04\x10\x9f\xe5\x01\xf4\x41\xe2
```

You can also read my other posts related to `Raspberry Pi`:

* [Set Static IP Address in Linux/Raspbian OS](https://shantoroy.com/linux/set-static-hostname-linux-mac-windows-raspbian/)

* [How to Configure a Raspberry Pi as Gateways between two Private Local Area Network using Ethernet Interfaces](https://shantoroy.com/raspberry%20pi/how-to-configure-raspberry-pi-as-gateway/)

* [How to fix the Ubuntu Black Screen Issue in a Raspberry Pi after Installation](https://shantoroy.com/ubuntu/ubuntu-HDMI-black-screen-issue-in-raspberry-pi/)

* [Live Video Monitoring using a Raspberry Pi and any Webcam](https://shantoroy.com/raspberry%20pi/live-monitoring-using-raspberry-pi-and-any-webcam/)

* [Set Up Headless Kali Linux in a Raspberry Pi 4 without Monitor, Keyboard, and Mouse](https://shantoroy.com/security/install-kali-linux-in-raspberry-pi-4/)


* [ARM Exploitation with Raspberry Pi: Basic Stack Overflow](https://shantoroy.com/security/ARM-exploitation-raspberry-pi-stack-overflow/)

* [ARM Exploitation with Raspberry Pi: Return Back to Program without Crashing](https://shantoroy.com/security/avoid-segmentation-fault-return-from-shellcode/)

* [ARM Exploitation with Raspberry Pi: ARM Ret-to-Libc](https://shantoroy.com/security/ret-to-libc-arm-exploitation-raspberry-pi/)

* [Build a Balena Cloud using Raspberry Pi](https://shantoroy.com/raspberry%20pi/balenaOS-install-raspberry-pi-balenacloud/)

-   [How to Configure a Raspberry Pi as an OpenFlow Switch: Steps, Issues, and Solutions](https://shantoroy.com/openflow/how-to-configure-raspberry-pi-as-open-flow-switch/)

## Resources
1. [Azeria-labs ARM32 Exploitation Series](https://azeria-labs.com/writing-arm-shellcode/)
2. [introduction-to-exploit-development](https://gitlab.com/yusefkarim/introduction-to-exploit-development)
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTA1OTA5NTIxNCwzNzA5NTc4MjgsLTEwMz
k3NTI5ODIsMTA2MDYwOTM0NSw5NDk1NjEyNzUsLTg1OTU3NjEw
NCwtMTUzNTAxNTcwMywxMTcxNDA5NTQ5LC0xMzI0ODQ0Miw1Mz
AwMTEwNiwtMzMyMTc0MTQ4XX0=
-->